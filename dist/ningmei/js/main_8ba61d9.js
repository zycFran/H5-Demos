function initPage(){pageWidth=$(window).width(),pageHeight=$(window).height(),sections=$(".wrap section"),totalPages=sections.length,$(".wrap").height(pageHeight),sections.height(pageHeight).show(),initWeixin(),animatePage(curPage)}function onStart(e){return 1==movePrevent?(e.preventDefault(),!1):(scrollPrevent=!1,touchDown=!0,startX=e.pageX,startY=e.pageY,margin=$(".sec").css("-webkit-transform"),margin=margin.replace("matrix(",""),margin=margin.replace(")",""),margin=margin.split(","),void(margin=parseInt(margin[5])))}function onMove(e,n){return 1==movePrevent||1!=touchDown?(n.preventDefault(),!1):(n.preventDefault(),e.pageY<startY&&curPage>=8?!1:void(0==scrollPrevent&&e.pageY!=startY))}function onEnd(e){if(1==movePrevent)return e.preventDefault(),!1;if(touchDown=!1,0==scrollPrevent)if(endX=e.pageX,endY=e.pageY,Math.abs(endY-startY)<=50)animatePage(curPage);else if(endY>startY)prevPage();else{if(startY>endY&&curPage>=8)return!1;nextPage()}}function prevPage(){var e=curPage-1;animatePage(e)}function nextPage(){var e=curPage+1;animatePage(e)}function animatePage(e){if(0>e&&(e=0),e>totalPages-1&&(e=totalPages-1),e!=totalPages-1||!render_page12){curPage=e;var n=e*-pageHeight;$(".sec").css({"-webkit-transform":"matrix(1, 0, 0, 1, 0, "+n+")"}),11==curPage&&(render_page12=!0),4==curPage&&$(".page5 .txt3").addClass("fadeIn"),5==curPage&&$(".page6 .txt3").addClass("fadeIn"),8!=curPage||render_page9||(render_page9=!0,setTimeout(function(){$(".page9 .tt3").hide()},2e3)),movePrevent=!0,setTimeout(function(){movePrevent=!1,11==curPage&&($(".page12").show().siblings().hide(),$(".sec").css({transition:"none","-webkit-transition":"none","-webkit-transform":"matrix(1, 0, 0, 1, 0, 0)"}))},300)}}function orient(){return 0==window.orientation||180==window.orientation?($("#land").hide(),!1):90==window.orientation||-90==window.orientation?($("#land").find("p").css("top",$(window).height()/2).css("left",$(window).width()/2-80),$("#land").show(),!1):void 0}function bindEvent(){$("body").on("touchstart",function(e){e=e.changedTouches[0],onStart(e)}).on("touchmove",function(e){onMove(e.changedTouches[0],e)}).on("touchend",function(e){onEnd(e.changedTouches[0])}),$(document).on("orientationchange",function(){orient()}),$(".page10, .page12").on("touchstart",function(e){e.preventDefault(),e.stopPropagation()}),$(".page9 .btn").on("touchend",function(e){e.stopPropagation(),p9_name=$(".page9 .thing").eq(p9_index).attr("name"),AjaxFunc.saveAction({url:API_URL.select,data:{name:p9_name},callback:function(e){p9_num=e.value||9515,$(".page10 .name").text(p9_name),$(".page10 .num").text(p9_num),initWeixin(),nextPage()}})}),$(".page10 .btn1").on("touchend",function(e){e.stopPropagation(),prevPage()}),$(".page10 .btn2").on("touchend",function(e){e.stopPropagation(),nextPage()}),$(".page10 .btn3").on("touchend",function(e){e.stopPropagation(),$(".page10 .rule").show()}),$(".page10 .rule .close").on("touchend",function(e){e.stopPropagation(),$(".page10 .rule").hide()}),$(".page11 .btn").on("touchend",function(e){e.stopPropagation(),nextPage()});var e=0;$(".page11 .point").on("touchend",function(n){n.stopPropagation();var t=$(this).index();e!=t&&(e=t,$(".tips").removeClass("fadeIn").eq(t).addClass("fadeIn"))}),$(".page11 .close").on("touchend",function(n){n.stopPropagation(),e=-1,$(".tips").removeClass("fadeIn")}),$(".page12 .confirm").on("touchend",function(e){e.stopPropagation(),$(".success").hide(),$(".share").show()}),$(".page12 .close").on("touchend",function(e){e.stopPropagation(),$(".success").hide()}),$(".page12 input").on("touchstart",function(e){e.stopPropagation()}).on("blur",function(){animatePage(curPage)}),$(".page12 .share").on("touchstart",function(){$(".share").hide()}),$(".page12 .btn").on("touchend",function(e){e.stopPropagation();var n=getFormData(),t=validateForm(n);return t.success?(n.ActivityName=ActivityName,void AjaxFunc.saveAction({url:API_URL.signup,data:n,callback:function(e){e.success?$(".success").show():setTimeout(function(){$(".success").hide(),$(".share").show()},2e3)}})):void X.dialog.tips(t.message)}),$(".right_btn").on("touchend",function(e){e.stopPropagation(),p9_index>=p9_size-1||(p9_index++,$("#things-wrap").css({"-webkit-transform":"translate("+-p9_thing_width*p9_index+"px,0)",transform:"translate("+-p9_thing_width*p9_index+"px,0)"}),fixShineBorder())}),$(".left_btn").on("touchend",function(e){e.stopPropagation(),0>=p9_index||(p9_index--,$("#things-wrap").css({"-webkit-transform":"translate("+-p9_thing_width*p9_index+"px,0)",transform:"translate("+-p9_thing_width*p9_index+"px,0)"}),fixShineBorder())}),$(".audio").on("touchend",function(){$(".audio").toggleClass("pause"),$(".audio").hasClass("pause")?$("#k_ring")[0].pause():$("#k_ring")[0].play()})}function initWeixin(){var e=new WeixinTools({debug:!1,signatureUrl:API_URL.signatureUrl,apis:["checkJsApi","onMenuShareTimeline","onMenuShareAppMessage"]}),n={title:"我和全国"+p9_num+"人一样选择了"+p9_name+"，你会选择哪款曾经带给你快乐的神器？",desc:"我们一直热爱游戏，因为我们一直在探寻快乐的意义。快乐是什么？是方块机？红白机？PS3？网吧电脑？当我们长大，看看那些曾经带给我们快乐的游戏机，追忆童年！",imgUrl:"http://www.hydeze.com/s/ningmei/images/share.jpg",link:"http://www.hydeze.com/r/cwm/urlRedirect?id=3"};p9_name||(n={title:"探寻快乐的意义，致那些年带给我们童年快乐的游戏机！",desc:"我们一直热爱游戏，因为我们一直在探寻快乐的意义。快乐是什么？是方块机？红白机？PS3？网吧电脑？当我们长大，看看那些曾经带给我们快乐的游戏机，追忆童年！",imgUrl:"http://www.hydeze.com/s/ningmei/images/share.jpg",link:"http://www.hydeze.com/r/cwm/urlRedirect?id=3"}),wx.ready(function(){e.shareAppMessage(n),e.shareTimeline(n),wx.checkJsApi({jsApiList:["onMenuShareTimeline","onMenuShareAppMessage"],success:function(){}}),wx.onMenuShareAppMessage({title:n.title,desc:n.desc,link:n.link,imgUrl:n.imgUrl,success:function(){shareHandler(1)},cancel:function(){}}),wx.onMenuShareTimeline({title:n.title,link:n.link,imgUrl:n.imgUrl,success:function(){shareHandler(2)},cancel:function(){}})})}function shareHandler(e){AjaxFunc.getAction({url:API_URL.shareFromWeixin,data:{type:e,activityName:ActivityName},callback:function(){}})}function fixShineBorder(){p9_index>=p9_size-1?$(".right_btn").removeClass("shine_ani"):$(".right_btn").addClass("shine_ani"),0>=p9_index?$(".left_btn").removeClass("shine_ani"):$(".left_btn").addClass("shine_ani")}function getFormData(){var e={};return e.name=$("#form-name").val()||"",e.phoneNumber=$("#form-phone").val()||"",e.QQNumber=$("#form-qq").val()||"",e.faverGame=$("#form-game").val()||"",e.reason=$("#form-reason").val()||"",e}function validateForm(e){var n=!0,t="";return e.reason||(n=!1,t="请填写申请理由"),e.faverGame||(n=!1,t="请填写最爱的游戏"),e.QQNumber||(n=!1,t="请填写QQ号"),e.phoneNumber?X.valid.isMobile(e.phoneNumber)||(n=!1,t="请输入正确的手机号"):(n=!1,t="请填写手机号"),e.name||(n=!1,t="请填写姓名"),{success:n,message:t}}var pageWidth,pageHeight,curPage=0,scrollPrevent,movePrevent,touchDown,startX,startY,margin,endX,endY,totalPages=12,sections=12,process=0,$process,p9_index=0,p9_size=6,p9_thing_width,p9_name="",p9_num=9515,ActivityName="宁美国度",API_URL={shareFromWeixin:API_BASE+"cwm/shareFromWeixin?_dt="+Math.random(),select:API_BASE+"cwm/ningmei/select?_dt="+Math.random(),signup:API_BASE+"cwm/signup?_dt="+Math.random(),signatureUrl:API_BASE+"wxconfig?_dt="+Math.random()},loaded=!1,num=0,inited=!1,timer_loader=setInterval(function(){$process||($process=$("#process")),$process&&(loaded&&(num++,inited||(inited=!0,UtilFunc.initApiUrl(API_URL),initPage(),bindEvent()),process+=5),num>=10&&(clearInterval(timer_loader),$(".preload").hide(),$(".main-wrap").show(),$("#k_ring")[0].play(),p9_thing_width=$("#things-wrap .thing").width()),process+=2,8==num&&(process=98),$process.text(Math.min(process,100)))},100);window.onload=function(){loaded=!0};var render_page12=!1,render_page9=!1;